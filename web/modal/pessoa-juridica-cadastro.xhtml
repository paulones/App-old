<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://xmlns.jcp.org/jsf/passthrough"
    xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <h:form prependId="false" id="modal_pj_form" class="form-horizontal">
        <h:panelGroup id="modal-new-pj">
            <h:panelGroup layout="block" class="modal fade bs-modal-lg" id="largenewpj" p:data-backdrop="static" p:data-keyboard="false" p:tabindex="-1">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-body modal-pessoa">
                            <div class="portlet box blue-chambray">
                                <div class="portlet-title">
                                    <div class="caption">
                                        <i class="fa fa-edit"></i>Dados da Pessoa Jurídica
                                    </div>
                                </div>
                                <div class="portlet-body form">
                                    <div class="form-body">
                                        <div class="alert alert-danger form-error display-hide">
                                            <button class="close" data-close="alert"></button>
                                            Há alguns erros no formulário. Digite os dados corretamente.
                                        </div>
                                        <span class="help-block">Campos com * são obrigatórios.</span>
                                        <h3 class="form-section">Informações Empresariais</h3>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-3">Nome <span class="required"> * </span></label>
                                                    <div class="col-md-9">
                                                        <div class="input-icon right">
                                                            <i class="fa"></i>
                                                            <h:inputText class="form-control" id="modal_pj_name" autocomplete="off" value="#{templateBean.enderecoPessoaJuridica.pessoa.nome}"/>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--/span-->
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-3">CNPJ <span class="required"> * </span></label>
                                                    <div class="col-md-9">
                                                        <div class="input-icon right">
                                                            <i class="fa"></i>
                                                            <h:inputText class="form-control" id="modal_pj_cnpj" value="#{templateBean.enderecoPessoaJuridica.pessoa.cnpj}" converter="maskConverter"/>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--/span-->
                                        </div>
                                        <!--/row-->
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-3">Nome Fantasia</label>
                                                    <div class="col-md-9">
                                                        <div class="input-icon right">
                                                            <i class="fa"></i>
                                                            <h:inputText class="form-control" id="modal_pj_alias" value="#{templateBean.enderecoPessoaJuridica.pessoa.nomeFantasia}"/>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--/span-->
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-3">Tipo Empresarial</label>
                                                    <div class="col-md-9">
                                                        <h:selectOneMenu class="select2_category select2me form-control" p:placeholder="Selecione..." id="modal_pj_tipicidade" value="#{templateBean.enderecoPessoaJuridica.pessoa.tipoEmpresarialFk}" tabindex="1" converter="entityConverter">
                                                            <f:selectItem itemLabel="" itemValue=""/>
                                                            <f:selectItems value="#{templateBean.tipoEmpresarialList}" var="tipoEmpresarial" itemLabel="#{tipoEmpresarial.tipo}" itemValue="#{tipoEmpresarial}"/>
                                                        </h:selectOneMenu>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--/span-->
                                        </div>
                                        <!--/row-->
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-3">Inscrição Estadual</label>
                                                    <div class="col-md-9">
                                                        <div class="input-icon right">
                                                            <i class="fa"></i>
                                                            <h:inputText class="form-control" id="modal_pj_state" value="#{templateBean.enderecoPessoaJuridica.pessoa.inscricaoEstadual}" converter="maskConverter"/>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--/span-->
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-3">Inscrição Municipal</label>
                                                    <div class="col-md-9">
                                                        <div class="input-icon right">
                                                            <i class="fa"></i>
                                                            <h:inputText class="form-control" id="modal_pj_province" value="#{templateBean.enderecoPessoaJuridica.pessoa.inscricaoMunicipal}" p:maxlegth="30"/>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--/span-->
                                        </div>
                                        <!--/row-->
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-3">Situação</label>
                                                    <div class="col-md-9">
                                                        <div class="radio-list">
                                                            <h:selectOneRadio id="modal_pj_situacao" value="#{templateBean.enderecoPessoaJuridica.pessoa.situacao}">
                                                                <f:selectItem id="modal_pj_situacao-ativo" itemLabel="Ativo" itemValue="A"/>
                                                                <f:selectItem id="modal_pj_situacao-inativo" itemLabel="Inativo" itemValue="I"/>
                                                            </h:selectOneRadio>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--/span-->
                                            <!--/row-->
                                            <div class="col-md-6">
                                                <div class="form-group modal_pj_reason">
                                                    <label class="control-label col-md-3">Motivo da Desativação</label>
                                                    <div class="col-md-9 ">
                                                        <div class="input-icon right">
                                                            <i class="fa"></i>
                                                            <h:inputText class="form-control" id="modal_pj_reason" value="#{templateBean.enderecoPessoaJuridica.pessoa.motivoDaDesativacao}"/>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                            </div>
                                            <!--/span-->
                                        </div>
                                        <!--/row-->
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-3">Data de Criação</label>
                                                    <div class="col-md-9">
                                                        <div class="input-icon right">
                                                            <i class="fa"></i>
                                                            <h:inputText class="form-control modal_pj_data-de-criacao" id="modal_pj_iniDate" p:placeholder="dd/mm/aaaa" value="#{templateBean.enderecoPessoaJuridica.pessoa.dataDeCriacao}"/>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--/span-->
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-3">Grupo Econômico</label>
                                                    <div class="col-md-9">
                                                        <div class="input-icon right">
                                                            <i class="fa"></i>
                                                            <h:inputText class="form-control" id="modal_pj_group" value="#{templateBean.enderecoPessoaJuridica.pessoa.grupoEconomico}"/>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--/span-->
                                        </div>
                                        <!--/row-->
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-3">CNAE</label>
                                                    <div class="col-md-9">
                                                        <div class="input-icon right">
                                                            <i class="fa"></i>
                                                            <h:inputText class="form-control" id="modal_pj_cnae" value="#{templateBean.enderecoPessoaJuridica.pessoa.cnae}" converter="maskConverter"/>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--/span-->
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-3">NIRE</label>
                                                    <div class="col-md-9">
                                                        <div class="input-icon right">
                                                            <i class="fa"></i>
                                                            <h:inputText class="form-control" id="modal_pj_nire" value="#{templateBean.enderecoPessoaJuridica.pessoa.nire}" converter="maskConverter"/>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--/span-->
                                        </div>
                                        <!--/row--><br/><br/>
                                        <div class="row">
                                            <div class="col-md-9">
                                                <div class="form-group">
                                                    <label class="control-label col-md-2">Atividade Principal</label>
                                                    <div class="col-md-10">
                                                        <div class="input-icon right">
                                                            <i class="fa"></i>
                                                            <h:inputTextarea class="form-control obs" rows="3" id="modal_pj_activity1" value="#{templateBean.enderecoPessoaJuridica.pessoa.atividadePrincipal}"/>
                                                        </div>
                                                        <span class="help-block">
                                                            Informações gerais sobre a principal atividade da empresa.</span>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                        <!--/row-->
                                        <div class="row">
                                            <div class="col-md-9">
                                                <div class="form-group">
                                                    <label class="control-label col-md-2">Atividades Secundárias</label>
                                                    <div class="col-md-10">
                                                        <div class="input-icon right">
                                                            <i class="fa"></i>
                                                            <h:inputTextarea class="form-control obs" rows="3" id="modal_pj_activity2" value="#{templateBean.enderecoPessoaJuridica.pessoa.atividadeSecundaria}"/>
                                                        </div>
                                                        <span class="help-block">
                                                            Informações gerais sobre atividades extras exercidas pela empresa.</span>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                        <!--/row-->
                                        <h3 class="form-section">Endereço</h3>
                                        <!--/row-->
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-3">CEP</label>
                                                    <div class="col-md-9">
                                                        <div class="input-icon right">
                                                            <i class="fa"></i>
                                                            <h:inputText class="form-control" id="modal_pj_cep" value="#{templateBean.enderecoPessoaJuridica.endereco.cep}" converter="maskConverter"/></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--/span-->
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-3">Estado/Cidade</label>
                                                    <div class="col-md-3">
                                                        <h:selectOneMenu styleClass="select2_category select2me form-control" p:placeholder="UF" id="modal_pj_enduf" value="#{templateBean.enderecoPessoaJuridica.endereco.estadoFk}" tabindex="1" converter="entityConverter">
                                                            <f:ajax execute="@this" class="ajaxCity" event="valueChange" listener="#{templateBean.getCidadesPeloEstado()}" render="modal_pj_city2" />
                                                            <f:selectItem itemLabel="" itemValue=""/>
                                                            <f:selectItems value="#{templateBean.estadoList}" var="estado" itemLabel="#{estado.uf}" itemValue="#{estado}"/>
                                                        </h:selectOneMenu>
                                                    </div>
                                                    <h:panelGroup layout="block" class="col-md-6" id="modal_pj_city2">
                                                        <h:selectOneMenu class="select2_category select2me form-control modal_pj_endcity" p:placeholder="Cidade" id="modal_pj_endcity" value="#{templateBean.enderecoPessoaJuridica.endereco.cidadeFk}" tabindex="1" converter="entityConverter">
                                                            <f:selectItem itemLabel="" itemValue=""/>
                                                            <f:selectItems value="#{templateBean.cidadeEndList}" var="cidade" itemLabel="#{cidade.nome}" itemValue="#{cidade}"/>
                                                        </h:selectOneMenu>
                                                    </h:panelGroup>
                                                </div>
                                            </div>
                                            <!--/span-->
                                        </div>
                                        <!--/row-->
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-3">Endereço</label>
                                                    <div class="col-md-9">
                                                        <div class="input-icon right">
                                                            <i class="fa"></i>
                                                            <h:inputText class="form-control" id="modal_pj_address" value="#{templateBean.enderecoPessoaJuridica.endereco.endereco}"/>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-3">Número</label>
                                                    <div class="col-md-9">
                                                        <div class="input-icon right">
                                                            <i class="fa"></i>
                                                            <h:inputText class="form-control" onkeyup="this.value = this.value.replace(/[^\d]/, '')" value="#{templateBean.enderecoPessoaJuridica.endereco.numero}" id="modal_pj_number"/>
                                                        </div> </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!--/row-->
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-3">Complemento</label>
                                                    <div class="col-md-9">
                                                        <div class="input-icon right">
                                                            <i class="fa"></i>
                                                            <h:inputText class="form-control" id="modal_pj_complement" value="#{templateBean.enderecoPessoaJuridica.endereco.complemento}"/>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--/span-->
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-3">Bairro</label>
                                                    <div class="col-md-9">
                                                        <div class="input-icon right">
                                                            <i class="fa"></i>
                                                            <h:inputText class="form-control" id="modal_pj_neighborhood" value="#{templateBean.enderecoPessoaJuridica.endereco.bairro}"/>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--/span-->
                                        </div>
                                        <h3 class="form-section">Vínculos Administrativos</h3>
                                    <!--/row-->
                                    <div class="row">
                                        <div class="col-md-10">
                                            <div class="form-group">
                                                <label class="control-label col-md-2">CPF</label>
                                                <div class="col-md-10">
                                                    <h:inputText p:type="hidden" class="modal_pj_cpfVinculate select2_category form-control" id="modal_pj_pessoafisica" value="#{templateBean.pfVId}"/>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <button  class="btn blue-chambray" id="modal_pj_vinculatePF">
                                                <i class="fa fa-plus-circle"></i> Vincular</button>
                                            <h:commandLink styleClass="modal_pj_vinculatePF">
                                                <f:ajax event="click" execute="modal_pj_pessoafisica modal_pj_pessoaFisicaJuridica" listener="#{templateBean.vincularPessoaFisica}" render="modal_pj_pessoaFisicaJuridica"/>
                                            </h:commandLink>
                                        </div>
                                    </div>
                                    <!--/row-->
                                    <h:commandLink class="modal_pj_pfj-refresher">
                                        <f:ajax render="modal_pj_pessoaFisicaJuridica"/>
                                    </h:commandLink>
                                    <h:panelGroup id="modal_pj_pessoaFisicaJuridica">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <table class="modal_pj_vinculations table table-striped table-hover table-bordered">
                                                    <thead>
                                                        <tr>
                                                            <th style="width:20%">
                                                                CPF
                                                            </th>
                                                            <th style="width:20%">
                                                                Função
                                                            </th>
                                                            <th style="width:20%">
                                                                Capital de Participação
                                                            </th>
                                                            <th style="width:18%">
                                                                Data de Início
                                                            </th>
                                                            <th style="width:18%">
                                                                Data de Término
                                                            </th>
                                                            <th style="width:4%">
                                                            </th>
                                                        </tr>
                                                    </thead>
                                                    <tbody class="modal_pj_rows-pfj">
                                                        <ui:repeat value="#{templateBean.pessoaFisicaJuridicaList}" var="pessoaFisicaJuridica" varStatus="status">
                                                            <ui:param value="#{pessoaFisicaJuridica.pessoaFisicaFk.cpf.substring(0,3)}.#{pessoaFisicaJuridica.pessoaFisicaFk.cpf.substring(3,6)}.#{pessoaFisicaJuridica.pessoaFisicaFk.cpf.substring(6,9)}-#{pessoaFisicaJuridica.pessoaFisicaFk.cpf.substring(9)}" name="cpf"/>
                                                            <tr>
                                                                <td>
                                                                        #{cpf  eq '..-' ? '-' : cpf}<br/>#{pessoaFisicaJuridica.pessoaFisicaFk.nome}
                                                                </td>
                                                                <td>
                                                                    <h:selectOneMenu styleClass="select2_category select2me form-control modal_pj_funcao" p:placeholder="Selecione..." value="#{pessoaFisicaJuridica.funcaoFk}" tabindex="1" converter="entityConverter">
                                                                        <f:selectItem itemLabel="" itemValue=""/>
                                                                        <f:selectItems value="#{templateBean.funcaoList}" var="funcao" itemLabel="#{funcao.funcao}" itemValue="#{funcao}"/>
                                                                    </h:selectOneMenu>
                                                                </td>
                                                                <td>
                                                                    <h:inputText class="form-control input-small modal_pj_capital-pfj" value="#{pessoaFisicaJuridica.capitalDeParticipacao}" p:placeholder="%"/>
                                                                </td>
                                                                <td>
                                                                    <h:inputText class="form-control input-small modal_pj_date modal_pj_initial-date" value="#{pessoaFisicaJuridica.dataDeInicio}" p:placeholder="dd/mm/aaaa" />
                                                                </td>
                                                                <td>
                                                                    <h:inputText  class="form-control input-small modal_pj_date modal_pj_final-date" p:placeholder="dd/mm/aaaa" value="#{pessoaFisicaJuridica.dataDeTermino}"/>
                                                                </td>
                                                                <td>
                                                                    <h:commandLink class="modal_pj_delete-pfj">
                                                                        <f:ajax execute="@this" listener="#{templateBean.removerVinculoFisico(status.index)}"/>
                                                                        <i class="glyphicon glyphicon-remove" style="color:red"/> </h:commandLink>
                                                                </td>
                                                            </tr>
                                                        </ui:repeat>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </h:panelGroup>
                                    <div class="alert alert-danger modal_pj_date-error-pfj display-hide">
                                        <button class="close" data-close="alert"></button>
                                    </div>
                                    <!--/row-->
                                    <h3 class="form-section">Vínculos Empresariais</h3>
                                    <!--/row-->
                                    <div class="row">
                                        <div class="col-md-10">
                                            <div class="form-group">
                                                <label class="control-label col-md-2">CNPJ</label>
                                                <div class="col-md-10">
                                                    <h:inputText p:type="hidden" class="modal_pj_cnpjVinculate select2_category form-control" id="modal_pj_pessoajuridica" value="#{templateBean.pjVId}"/>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <button  class="btn blue-chambray" id="modal_pj_vinculatePJ">
                                                <i class="fa fa-plus-circle"></i> Vincular</button>
                                            <h:commandLink styleClass="modal_pj_vinculatePJ">
                                                <f:ajax event="click" execute="modal_pj_pessoajuridica modal_pj_pessoaJuridicaJuridica" listener="#{templateBean.vincularPessoaJuridica}" render="modal_pj_pessoaJuridicaJuridica"/>
                                            </h:commandLink>
                                        </div>
                                    </div>
                                    <!--/row-->
                                    <h:commandLink class="modal_pj_pjj-refresher">
                                        <f:ajax render="modal_pj_pessoaJuridicaJuridica"/>
                                    </h:commandLink>
                                    <h:panelGroup id="modal_pj_pessoaJuridicaJuridica">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <table class="modal_pj_vinculations table table-striped table-hover table-bordered">
                                                    <thead>
                                                        <tr>
                                                            <th style="width:20%">
                                                                CNPJ
                                                            </th>
                                                            <th style="width:20%">
                                                                Capital de Participação
                                                            </th>
                                                            <th style="width:18.5%">
                                                                Data de Início
                                                            </th>
                                                            <th style="width:18.5%">
                                                                Data de Término
                                                            </th>
                                                            <th style="width:3%">
                                                            </th>
                                                        </tr>
                                                    </thead>
                                                    <tbody class="modal_pj_rows-pjj">
                                                        <ui:repeat value="#{templateBean.pessoaJuridicaJuridicaList}" var="pessoaJuridicaJuridica" varStatus="status">
                                                                <ui:param value="#{pessoaJuridicaJuridica.pessoaJuridicaSocioBFk.cnpj.substring(0,2)}.#{pessoaJuridicaJuridica.pessoaJuridicaSocioBFk.cnpj.substring(2,5)}.#{pessoaJuridicaJuridica.pessoaJuridicaSocioBFk.cnpj.substring(5,8)}/#{pessoaJuridicaJuridica.pessoaJuridicaSocioBFk.cnpj.substring(8,12)}-#{pessoaJuridicaJuridica.pessoaJuridicaSocioBFk.cnpj.substring(12)}" name="cnpj"/>
                                                                <tr>
                                                                    <td>
                                                                            #{cnpj}<br/>#{pessoaJuridicaJuridica.pessoaJuridicaSocioBFk.nome}
                                                                    </td>
                                                                    <td>
                                                                        <h:inputText class="form-control input-small modal_pj_capital-pjj" value="#{pessoaJuridicaJuridica.capitalDeParticipacao}" p:placeholder="%" />
                                                                    </td>
                                                                    <td>
                                                                        <h:inputText class="form-control input-small modal_pj_date modal_pj_initial-date" value="#{pessoaJuridicaJuridica.dataDeInicio}" p:placeholder="dd/mm/aaaa" />
                                                                    </td>
                                                                    <td>
                                                                        <h:inputText  class="form-control input-small modal_pj_date modal_pj_final-date" p:placeholder="dd/mm/aaaa" value="#{pessoaJuridicaJuridica.dataDeTermino}"/>
                                                                    </td>
                                                                    <td>
                                                                        <h:commandLink class="modal_pj_delete-pjj">
                                                                            <f:ajax execute="@this" listener="#{templateBean.removerVinculoJuridico(status.index)}"/>
                                                                            <i class="glyphicon glyphicon-remove" style="color:red"/> </h:commandLink>
                                                                    </td>
                                                                </tr>
                                                        </ui:repeat>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </h:panelGroup>
                                    <div class="alert alert-danger modal_pj_date-error-pjj display-hide">
                                        <button class="close" data-close="alert"></button>
                                    </div>
                                </div>
                                        <h3 class="form-section"></h3> 
                                        <!--/row-->
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="col-md-offset-9 col-md-3">
                                                    <div class="col-md-5">
                                                        <button type="button" data-dismiss="modal" class="btn blue-chambray">Fechar</button>
                                                    </div>
                                                    <div class="col-md-7">
                                                        <button type="submit" class="modal_pj_submit-pj btn blue-chambray">
                                                            <i class="fa fa-save"></i> Cadastrar
                                                        </button>
                                                    </div>
                                                </div>
                                                <h:commandLink styleClass="modal_pj_register">
                                                    <f:ajax execute="@form" listener="#{templateBean.cadastrarPJ()}" render="modal_pj_id" />
                                                </h:commandLink>
                                                <h:inputHidden id="modal_pj_id" value="#{templateBean.enderecoPessoaJuridica.pessoa.id}"/>
                                            </div>
                                        </div>
                                        <br/> 
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- /.modal-content -->
                    </div>
                    <!-- /.modal-dialog -->
            </h:panelGroup>
        </h:panelGroup>
    </h:form>
</ui:composition>
